<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.5">
    <title>纺织产业控制塔 · 智能订单溯源</title>
    <!-- Font Awesome 6 图标库 -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        /* ========== 全局设计变量 ========== */
        :root {
            /* 色彩系统 */
            --primary: #3a7bd5;
            --primary-dark: #2c5fa5;
            --primary-light: rgba(58, 123, 213, 0.1);
            --secondary: #00d2ff;
            --success: #1dd1a1;
            --success-light: rgba(29, 209, 161, 0.1);
            --warning: #feca57;
            --danger: #ff6b6b;
            --gray-light: #f8f9fa;
            --gray: #6c757d;
            --gray-dark: #343a40;
            --border: #dee2e6;
            --card-bg: #ffffff;
            
            /* 间距 */
            --space-xs: 0.5rem;
            --space-sm: 1rem;
            --space-md: 1.5rem;
            --space-lg: 2rem;
            --space-xl: 3rem;
            
            /* 字体 */
            --font-main: 'Segoe UI', 'Microsoft YaHei', sans-serif;
            --text-sm: 0.875rem;
            --text-base: 1rem;
            --text-lg: 1.25rem;
            --text-xl: 1.5rem;
            --text-xxl: 2rem;
            
            /* 阴影 */
            --shadow-sm: 0 2px 4px rgba(0,0,0,0.05);
            --shadow-md: 0 4px 12px rgba(0,0,0,0.08);
            --shadow-lg: 0 8px 24px rgba(0,0,0,0.12);
            
            /* 圆角 */
            --radius-sm: 6px;
            --radius-md: 10px;
            --radius-lg: 16px;
            
            /* 过渡 */
            --transition-fast: 0.2s ease;
            --transition-normal: 0.3s ease;
            --transition-slow: 0.5s ease;
        }

        /* ========== 重置 & 基础 ========== */
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: var(--font-main);
            background: linear-gradient(145deg, #f5f7fa 0%, #e9edf5 100%);
            color: var(--gray-dark);
            line-height: 1.6;
            min-height: 100vh;
            padding-bottom: var(--space-xl);
        }
        .container {
            max-width: 1280px;
            margin: 0 auto;
            padding: var(--space-md);
        }

        /* ========== 头部区域 ========== */
        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: var(--space-md) 0;
            margin-bottom: var(--space-md);
        }
        .logo {
            display: flex;
            align-items: center;
            gap: var(--space-sm);
        }
        .logo-icon {
            color: var(--primary);
            font-size: var(--text-xxl);
        }
        .logo-text {
            font-size: var(--text-xl);
            font-weight: 700;
            color: var(--gray-dark);
            letter-spacing: -0.5px;
        }
        .logo-subtext {
            font-size: var(--text-sm);
            color: var(--gray);
            margin-left: var(--space-sm);
            font-weight: 400;
        }
        .user-info {
            display: flex;
            align-items: center;
            gap: var(--space-sm);
            background: var(--card-bg);
            padding: 8px 16px;
            border-radius: var(--radius-md);
            box-shadow: var(--shadow-sm);
        }
        .user-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: linear-gradient(145deg, var(--primary), var(--secondary));
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
        }

        /* ========== 筛选栏 ========== */
        .filter-bar {
            background: var(--card-bg);
            border-radius: var(--radius-md);
            padding: var(--space-md);
            margin-bottom: var(--space-lg);
            box-shadow: var(--shadow-md);
            display: flex;
            flex-wrap: wrap;
            align-items: center;
            gap: var(--space-md);
        }
        .filter-group {
            display: flex;
            align-items: center;
            gap: var(--space-xs);
        }
        .filter-label {
            font-size: var(--text-sm);
            color: var(--gray);
            font-weight: 600;
        }
        .filter-select {
            padding: 8px 12px;
            border: 1px solid var(--border);
            border-radius: var(--radius-sm);
            font-size: var(--text-sm);
            background: white;
            cursor: pointer;
            outline: none;
            transition: border-color var(--transition-fast);
        }
        .filter-select:focus { border-color: var(--primary); }
        .filter-btn {
            padding: 8px 16px;
            background: var(--primary);
            color: white;
            border: none;
            border-radius: var(--radius-sm);
            font-size: var(--text-sm);
            font-weight: 600;
            cursor: pointer;
            transition: background var(--transition-fast);
        }
        .filter-btn:hover { background: var(--primary-dark); }
        .filter-btn.reset {
            background: var(--gray-light);
            color: var(--gray-dark);
        }
        .filter-btn.reset:hover { background: var(--border); }

        /* ========== 订单分类卡片 ========== */
        .order-categories {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: var(--space-lg);
            margin-bottom: var(--space-xl);
        }
        .order-category {
            background: var(--card-bg);
            border-radius: var(--radius-md);
            box-shadow: var(--shadow-md);
            overflow: hidden;
            transition: all var(--transition-normal);
            max-height: 70px;
            cursor: pointer;
        }
        .order-category.active {
            max-height: 600px;
            box-shadow: var(--shadow-lg);
        }
        .category-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: var(--space-md);
            background: linear-gradient(90deg, var(--primary-light), transparent);
            border-bottom: 1px solid var(--border);
        }
        .category-header.active {
            background: linear-gradient(90deg, var(--primary), var(--secondary));
            color: white;
        }
        .category-title {
            display: flex;
            align-items: center;
            gap: var(--space-sm);
            font-size: var(--text-lg);
            font-weight: 600;
        }
        .category-count {
            background: var(--gray-light);
            color: var(--gray-dark);
            padding: 4px 12px;
            border-radius: 20px;
            font-size: var(--text-sm);
            font-weight: 600;
            margin-left: var(--space-sm);
        }
        .active .category-count {
            background: rgba(255,255,255,0.2);
            color: white;
        }
        .category-icon {
            font-size: 1.2rem;
            transition: transform var(--transition-normal);
        }
        .active .category-icon { transform: rotate(180deg); }
        .category-content {
            padding: 0;
            max-height: 0;
            opacity: 0;
            overflow: hidden;
            transition: all var(--transition-slow);
        }
        .active .category-content {
            padding: var(--space-md);
            max-height: 500px;
            opacity: 1;
        }

        /* ========== 订单选择列表 ========== */
        .order-selection-title {
            font-size: var(--text-base);
            font-weight: 600;
            margin-bottom: var(--space-sm);
            color: var(--gray);
        }
        .order-list {
            display: grid;
            grid-template-columns: 1fr;
            gap: var(--space-sm);
            max-height: 400px;
            overflow-y: auto;
        }
        .order-item {
            background: var(--gray-light);
            border-radius: var(--radius-sm);
            padding: var(--space-sm);
            cursor: pointer;
            transition: all var(--transition-fast);
            border: 2px solid transparent;
            display: flex;
            flex-direction: column;
        }
        .order-item:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-sm);
            border-color: var(--primary-light);
        }
        .order-item.selected {
            background: var(--primary-light);
            border-color: var(--primary);
        }
        .order-main-info {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 6px;
        }
        .order-id { font-weight: 700; color: var(--gray-dark); }
        .order-gs1 {
            font-size: var(--text-sm);
            color: var(--gray);
            background: rgba(0,0,0,0.05);
            padding: 2px 8px;
            border-radius: 12px;
        }
        .order-details-info {
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: var(--text-sm);
        }
        .order-amount { font-weight: 600; color: var(--primary); }
        .order-date { color: var(--gray); }
        .order-status {
            padding: 4px 8px;
            border-radius: 12px;
            font-weight: 600;
            font-size: var(--text-sm);
        }
        .status-active { background: var(--success-light); color: var(--success); }
        .status-completed { background: var(--gray-light); color: var(--gray); }

        /* ========== 订单详情区域 ========== */
        .order-details {
            background: var(--card-bg);
            border-radius: var(--radius-md);
            box-shadow: var(--shadow-md);
            overflow: hidden;
            margin-top: var(--space-lg);
            max-height: 0;
            opacity: 0;
            transition: all var(--transition-normal);
            padding: 0;
        }
        .order-details.active {
            max-height: 1000px;
            opacity: 1;
            padding: var(--space-md);
        }
        .details-header {
            padding: var(--space-md);
            background: var(--gray-light);
            border-radius: var(--radius-sm);
            margin-bottom: var(--space-md);
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
        }
        .details-title {
            display: flex;
            align-items: center;
            gap: var(--space-sm);
            flex-wrap: wrap;
            font-size: var(--text-lg);
            font-weight: 600;
        }
        .details-order-id { color: var(--primary); font-weight: 700; }
        .details-gs1 {
            font-size: var(--text-sm);
            color: var(--gray);
            background: rgba(0,0,0,0.05);
            padding: 4px 12px;
            border-radius: 20px;
        }
        .details-tabs {
            display: flex;
            border-bottom: 1px solid var(--border);
            background: var(--gray-light);
            border-radius: var(--radius-sm) var(--radius-sm) 0 0;
        }
        .tab {
            flex: 1;
            text-align: center;
            padding: var(--space-sm) var(--space-md);
            cursor: pointer;
            font-weight: 600;
            transition: all var(--transition-fast);
            border-bottom: 3px solid transparent;
        }
        .tab:hover { background: rgba(0,0,0,0.02); }
        .tab.active {
            border-bottom-color: var(--primary);
            color: var(--primary);
            background: var(--primary-light);
        }
        .tab-content {
            padding: var(--space-md);
            display: none;
        }
        .tab-content.active {
            display: block;
            animation: fadeIn 0.5s ease;
        }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }

        /* ========== 横向进度条 ========== */
        .progress-horizontal {
            display: flex;
            justify-content: space-between;
            position: relative;
            margin: var(--space-lg) 0;
            padding: 0 var(--space-md);
            overflow-x: auto;
        }
        .progress-horizontal::before {
            content: '';
            position: absolute;
            top: 20px;
            left: 40px;
            right: 40px;
            height: 3px;
            background: var(--border);
            z-index: 1;
        }
        .progress-step {
            display: flex;
            flex-direction: column;
            align-items: center;
            position: relative;
            z-index: 2;
            flex: 1;
            text-align: center;
            min-width: 90px;
        }
        .step-icon {
            width: 44px;
            height: 44px;
            border-radius: 50%;
            background: var(--border);
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: var(--space-xs);
            color: var(--gray);
            font-size: 1.2rem;
        }
        .step-completed .step-icon { background: var(--success); color: white; }
        .step-active .step-icon {
            background: var(--primary);
            color: white;
            box-shadow: 0 0 0 6px rgba(58,123,213,0.2);
        }
        .step-label { font-weight: 600; font-size: var(--text-sm); margin-bottom: 4px; }
        .step-time { font-size: var(--text-sm); color: var(--gray); }
        .step-description { font-size: var(--text-sm); color: var(--gray); margin-top: 4px; }

        /* ========== 物流纵向时间线 ========== */
        .logistics-timeline {
            position: relative;
            padding-left: 30px;
        }
        .logistics-timeline::before {
            content: '';
            position: absolute;
            top: 0;
            bottom: 0;
            left: 12px;
            width: 2px;
            background: var(--border);
            z-index: 1;
        }
        .logistics-event {
            position: relative;
            margin-bottom: var(--space-md);
            z-index: 2;
            display: flex;
            align-items: flex-start;
        }
        .event-dot {
            width: 24px;
            height: 24px;
            border-radius: 50%;
            background: var(--border);
            border: 3px solid white;
            margin-right: var(--space-sm);
            flex-shrink: 0;
            position: relative;
            left: -12px;
        }
        .event-completed .event-dot { background: var(--success); }
        .event-active .event-dot {
            background: var(--primary);
            box-shadow: 0 0 0 4px rgba(58,123,213,0.2);
        }
        .event-title { font-weight: 600; margin-bottom: 4px; }
        .event-time { font-size: var(--text-sm); color: var(--gray); margin-bottom: 4px; }
        .event-location { font-size: var(--text-sm); color: var(--gray); }

        /* ========== 溯源列表 ========== */
        .traceability-list { list-style: none; }
        .traceability-item {
            display: flex;
            padding: var(--space-sm) 0;
            border-bottom: 1px solid var(--border);
            align-items: flex-start;
        }
        .traceability-item:last-child { border-bottom: none; }
        .traceability-icon {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: var(--border);
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: var(--space-sm);
            color: var(--gray);
            flex-shrink: 0;
        }
        .traceability-completed .traceability-icon { background: var(--success-light); color: var(--success); }
        .traceability-active .traceability-icon { background: var(--primary-light); color: var(--primary); }
        .traceability-location { font-weight: 600; margin-bottom: 4px; }
        .traceability-description { font-size: var(--text-sm); color: var(--gray); margin-bottom: 4px; }
        .traceability-time { font-size: var(--text-sm); color: var(--gray); }

        /* ========== 已完成订单汇总卡片 ========== */
        .completed-summary {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: var(--space-md);
            margin-bottom: var(--space-lg);
        }
        .summary-card {
            background: var(--gray-light);
            border-radius: var(--radius-sm);
            padding: var(--space-md);
            text-align: center;
        }
        .summary-value {
            font-size: var(--text-xl);
            font-weight: 700;
            color: var(--primary);
            margin-bottom: 4px;
        }
        .summary-label { font-size: var(--text-sm); color: var(--gray); }

        /* ========== 空状态 ========== */
        .empty-state {
            text-align: center;
            padding: var(--space-xl);
            color: var(--gray);
        }
        .empty-icon { font-size: 3rem; color: var(--border); margin-bottom: var(--space-sm); }

        /* ========== 响应式 ========== */
        @media (max-width: 768px) {
            .order-categories { grid-template-columns: 1fr; }
            .progress-horizontal {
                flex-direction: column;
                align-items: flex-start;
                padding: 0;
            }
            .progress-horizontal::before { display: none; }
            .progress-step {
                flex-direction: row;
                width: 100%;
                margin-bottom: var(--space-md);
                align-items: center;
                text-align: left;
            }
            .step-icon { margin-right: var(--space-sm); margin-bottom: 0; }
            .completed-summary { grid-template-columns: 1fr; }
            .filter-bar { flex-direction: column; align-items: stretch; }
            .filter-group { justify-content: space-between; }
            .details-header { flex-direction: column; align-items: flex-start; gap: var(--space-sm); }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- ========== 页眉 ========== -->
        <header class="header">
            <div class="logo">
                <i class="fas fa-industry logo-icon"></i>
                <div>
                    <div class="logo-text" id="systemName">纺织产业控制塔</div>
                    <div class="logo-subtext" id="systemSubtitle">智能订单溯源系统</div>
                </div>
            </div>
            <div class="user-info">
                <div class="user-avatar" id="userAvatar">蔡</div>
                <div>
                    <div id="userName">蔡经理</div>
                    <div id="userRole" style="font-size:0.8rem;color:var(--gray);">客户代表</div>
                </div>
            </div>
        </header>

        <!-- ========== 动态筛选栏 ========== -->
        <div class="filter-bar" id="filterBar"></div>

        <!-- ========== 订单分类卡片 ========== -->
        <div class="order-categories">
            <!-- 实时订单卡片 -->
            <div class="order-category" id="categoryActive">
                <div class="category-header">
                    <div class="category-title">
                        <i class="fas fa-clock"></i>
                        <span id="activeTitle">实时订单</span>
                        <div class="category-count" id="activeCount">0</div>
                    </div>
                    <div class="category-icon"><i class="fas fa-chevron-down"></i></div>
                </div>
                <div class="category-content">
                    <div class="order-selection">
                        <div class="order-selection-title" id="activeSelectLabel">请选择要查看的实时订单：</div>
                        <div class="order-list" id="activeOrderList"></div>
                    </div>
                </div>
            </div>
            <!-- 已完成订单卡片 -->
            <div class="order-category" id="categoryCompleted">
                <div class="category-header">
                    <div class="category-title">
                        <i class="fas fa-check-circle"></i>
                        <span id="completedTitle">已完成订单</span>
                        <div class="category-count" id="completedCount">0</div>
                    </div>
                    <div class="category-icon"><i class="fas fa-chevron-down"></i></div>
                </div>
                <div class="category-content">
                    <div class="order-selection">
                        <div class="order-selection-title" id="completedSelectLabel">请选择要查看的已完成订单：</div>
                        <div class="order-list" id="completedOrderList"></div>
                    </div>
                </div>
            </div>
        </div>

        <!-- ========== 订单详情容器 ========== -->
        <div class="order-details" id="orderDetails"></div>
    </div>

    <script>
        // ============================================================================
        // 1. 全局静态数据（集中管理，便于维护）
        // ============================================================================

        /** 界面所有文本标签，修改此处可快速实现多语言或文案调整 */
        const TEXT = {
            systemName: "纺织产业控制塔——客户中心",
            systemSubtitle: "智能订单溯源系统",
            userRole: "客户代表",
            activeOrdersTitle: "实时订单",
            completedOrdersTitle: "已完成订单",
            selectActiveOrder: "请选择要查看的实时订单：",
            selectCompletedOrder: "请选择要查看的已完成订单：",
            filterDate: "下单日期",
            filterDateAll: "全部",
            filterDate7d: "最近7天",
            filterDate30d: "最近30天",
            filterDate90d: "最近90天",
            filterDateYear: "今年",
            filterStatus: "订单状态",
            filterStatusAll: "全部状态",
            filterStatusConfirmed: "已确认",
            filterStatusScheduled: "已排产",
            filterStatusProducing: "生产中",
            filterStatusShipped: "已发货",
            filterStatusCompleted: "已完成",
            filterApply: "应用筛选",
            filterReset: "重置",
            orderDetailsTitle: "订单详情",
            lastUpdate: "最后更新",
            progressTracking: "订单进度跟踪",
            logisticsTracking: "物流跟踪",
            traceability: "信息溯源",
            gs1Prefix: "GS1:",
            orderAmount: "订单金额",
            orderDate: "下单日期",
            deliveryDate: "交付日期",
            emptyActiveOrders: "暂无实时订单",
            emptyCompletedOrders: "暂无已完成订单"
        };

        /**
         * 实时订单数据集（JSON结构）
         * @property {string} id          - 订单号
         * @property {string} gs1         - 全球贸易项目代码
         * @property {string} amount      - 金额（含货币符号）
         * @property {string} date        - 下单日期 YYYY-MM-DD
         * @property {string} status      - 当前状态
         * @property {string} customer    - 客户名称
         * @property {Array}  progress    - 进度步骤（title, time, completed, description）
         * @property {Array}  logisticsEvents - 物流事件（title, time, location, completed）
         * @property {Array}  traceability    - 溯源节点（location, time, status, description）
         */
        const ACTIVE_ORDERS = [
            {
                id: "TX20230514001",
                gs1: "06940123456789",
                amount: "¥24,580",
                date: "2023-05-14",
                status: "生产中",
                customer: "上海纺织有限公司",
                progress: [
                    { title: "下单", time: "2023-05-14 11:26", completed: true, description: "订单已提交" },
                    { title: "审核", time: "2023-05-14 11:27", completed: true, description: "订单审核通过" },
                    { title: "付款", time: "2023-05-14 11:28", completed: true, description: "付款已确认" },
                    { title: "排产", time: "2023-05-14 14:00", completed: true, description: "已排入生产计划" },
                    { title: "生产", time: "2023-05-14 23:24", completed: true, description: "生产进行中" },
                    { title: "质检", time: "预计2023-05-20", completed: false, description: "等待质检" },
                    { title: "发货", time: "预计2023-05-22", completed: false, description: "等待发货" }
                ],
                logisticsEvents: [
                    { title: "已揽收", time: "2023-05-16 10:15", location: "珠海物流中心", completed: true },
                    { title: "运输中", time: "2023-05-16 14:30", location: "广珠高速", completed: true },
                    { title: "到达中转站", time: "2023-05-17 09:20", location: "广州分拨中心", completed: true },
                    { title: "派送中", time: "2023-05-18 08:45", location: "上海配送站", completed: false },
                    { title: "已签收", time: "预计2023-05-19", location: "上海纺织有限公司", completed: false }
                ],
                traceability: [
                    { location: "新疆棉花种植基地", time: "2023-03-10", status: "completed", description: "优质长绒棉采摘" },
                    { location: "山东纺织工厂", time: "2023-03-20", status: "completed", description: "棉纱纺制与质检" },
                    { location: "浙江印染工厂", time: "2023-04-05", status: "completed", description: "布料印染与处理" },
                    { location: "浙江纺织工厂", time: "2023-05-10", status: "active", description: "服装裁剪与缝制" },
                    { location: "上海质检中心", time: "预计2023-05-20", status: "pending", description: "成品质量检验" },
                    { location: "上海物流中心", time: "预计2023-05-22", status: "pending", description: "订单打包准备发货" }
                ]
            },
            {
                id: "TX20230515002",
                gs1: "06940123456790",
                amount: "¥18,920",
                date: "2023-05-15",
                status: "已排产",
                customer: "北京时尚集团",
                progress: [
                    { title: "下单", time: "2023-05-15 09:15", completed: true, description: "订单已提交" },
                    { title: "审核", time: "2023-05-15 09:30", completed: true, description: "订单审核通过" },
                    { title: "付款", time: "2023-05-15 10:05", completed: true, description: "付款已确认" },
                    { title: "排产", time: "2023-05-15 14:20", completed: true, description: "已排入生产计划" },
                    { title: "生产", time: "2023-05-16 14:20", completed: false, description: "等待生产" },
                    { title: "质检", time: "预计2023-05-21", completed: false, description: "待质检" },
                    { title: "发货", time: "预计2023-05-23", completed: false, description: "待发货" }
                ],
                logisticsEvents: [],
                traceability: [
                    { location: "新疆棉花种植基地", time: "2023-03-15", status: "completed", description: "有机棉采摘" },
                    { location: "江苏纺织工厂", time: "2023-03-25", status: "completed", description: "棉纱纺制与质检" },
                    { location: "浙江印染工厂", time: "2023-04-10", status: "completed", description: "环保印染处理" },
                    { location: "浙江纺织工厂", time: "2023-05-05", status: "completed", description: "高级定制服装制作" },
                    { location: "北京质检中心", time: "预计2023-05-20", status: "pending", description: "成品质量检验" },
                    { location: "北京物流中心", time: "预计2023-05-22", status: "pending", description: "订单打包准备发货" }
                ]
            },
            {
                id: "TX20230512003",
                gs1: "06940123456791",
                amount: "¥32,150",
                date: "2023-05-12",
                status: "运输中",
                customer: "广州进出口公司",
                progress: [
                    { title: "下单", time: "2023-05-12 14:30", completed: true, description: "订单已提交" },
                    { title: "审核", time: "2023-05-12 14:45", completed: true, description: "订单审核通过" },
                    { title: "付款", time: "2023-05-12 15:20", completed: true, description: "付款已确认" },
                    { title: "排产", time: "2023-05-12 16:30", completed: true, description: "已排产" },
                    { title: "生产", time: "2023-05-13 09:10", completed: true, description: "生产已完成" },
                    { title: "质检", time: "2023-05-15 16:30", completed: true, description: "质检通过" },
                    { title: "发货", time: "2023-05-16 10:15", completed: true, description: "已发货" }
                ],
                logisticsEvents: [
                    { title: "已揽收", time: "2023-05-16 10:15", location: "珠海物流中心", completed: true },
                    { title: "运输中", time: "2023-05-16 14:30", location: "广珠高速", completed: true },
                    { title: "到达中转站", time: "2023-05-17 09:20", location: "广州分拨中心", completed: true },
                    { title: "派送中", time: "2023-05-18 08:00", location: "广州配送站", completed: false },
                    { title: "已签收", time: "预计2023-05-19", location: "广州进出口公司", completed: false }
                ],
                traceability: [
                    { location: "新疆棉花种植基地", time: "2023-03-05", status: "completed", description: "优质长绒棉采摘" },
                    { location: "山东纺织工厂", time: "2023-03-18", status: "completed", description: "棉纱纺制与质检" },
                    { location: "江苏印染工厂", time: "2023-04-02", status: "completed", description: "布料印染与处理" },
                    { location: "浙江纺织工厂", time: "2023-05-01", status: "completed", description: "服装裁剪与缝制" },
                    { location: "广州质检中心", time: "2023-05-15", status: "completed", description: "成品质量检验" },
                    { location: "广州物流中心", time: "2023-05-16", status: "active", description: "运输途中" }
                ]
            }
        ];

        /** 已完成订单数据集（JSON结构，包含交付日期） */
        const COMPLETED_ORDERS = [
            {
                id: "TX20230428001",
                gs1: "06940123456792",
                amount: "¥15,680",
                date: "2023-04-28",
                deliveryDate: "2023-05-10",
                status: "已完成",
                customer: "杭州服装有限公司",
                traceability: [
                    { location: "新疆棉花种植基地", time: "2023-02-10", status: "completed", description: "有机棉采摘" },
                    { location: "山东纺织工厂", time: "2023-02-25", status: "completed", description: "棉纱纺制与质检" },
                    { location: "浙江印染工厂", time: "2023-03-12", status: "completed", description: "环保印染处理" },
                    { location: "浙江纺织工厂", time: "2023-04-05", status: "completed", description: "服装裁剪与缝制" },
                    { location: "上海质检中心", time: "2023-04-20", status: "completed", description: "成品质量检验" },
                    { location: "杭州物流中心", time: "2023-04-25", status: "completed", description: "订单打包发货" },
                    { location: "杭州仓库", time: "2023-05-10", status: "completed", description: "客户已签收" }
                ]
            },
            {
                id: "TX20230415002",
                gs1: "06940123456793",
                amount: "¥28,940",
                date: "2023-04-15",
                deliveryDate: "2023-05-05",
                status: "已完成",
                customer: "深圳贸易公司",
                traceability: [
                    { location: "新疆棉花种植基地", time: "2023-01-20", status: "completed", description: "优质长绒棉采摘" },
                    { location: "江苏纺织工厂", time: "2023-02-05", status: "completed", description: "棉纱纺制与质检" },
                    { location: "江苏印染工厂", time: "2023-02-25", status: "completed", description: "高级印染工艺" },
                    { location: "广东纺织工厂", time: "2023-03-20", status: "completed", description: "高级定制服装制作" },
                    { location: "深圳质检中心", time: "2023-04-10", status: "completed", description: "成品质量检验" },
                    { location: "深圳物流中心", time: "2023-04-28", status: "completed", description: "订单打包发货" },
                    { location: "深圳仓库", time: "2023-05-05", status: "completed", description: "客户已签收" }
                ]
            },
            {
                id: "TX20230405003",
                gs1: "06940123456794",
                amount: "¥12,350",
                date: "2023-04-05",
                deliveryDate: "2023-04-25",
                status: "已完成",
                customer: "南京零售集团",
                traceability: [
                    { location: "新疆棉花种植基地", time: "2023-01-15", status: "completed", description: "优质棉采摘" },
                    { location: "山东纺织工厂", time: "2023-01-30", status: "completed", description: "棉纱纺制" },
                    { location: "浙江印染工厂", time: "2023-02-15", status: "completed", description: "布料印染" },
                    { location: "江苏纺织工厂", time: "2023-03-10", status: "completed", description: "服装制作" },
                    { location: "南京质检中心", time: "2023-04-01", status: "completed", description: "质量检验" },
                    { location: "南京物流中心", time: "2023-04-20", status: "completed", description: "打包发货" },
                    { location: "南京门店", time: "2023-04-25", status: "completed", description: "交付完成" }
                ]
            }
        ];

        // ============================================================================
        // 2. 全局状态变量
        // ============================================================================

        /** 当前被选中的订单对象，null 表示无选中 */
        let selectedOrder = null;

        /** 当前选中订单的类型：'active' 实时  /  'completed' 已完成 */
        let selectedOrderType = null;

        /** 当前筛选条件 */
        let currentFilter = {
            dateRange: 'all',   // all, 7d, 30d, 90d, year
            status: 'all'       // all, 已确认, 已排产, 生产中, 已发货, 已完成
        };

        // ============================================================================
        // 3. 通用工具函数
        // ============================================================================

        /**
         * 生成当前时间的格式化字符串，用于“最后更新”
         * @returns {string} 例如 "今天 14:30"
         */
        function getFormattedNow() {
            const now = new Date();
            const hours = now.getHours();
            const minutes = now.getMinutes().toString().padStart(2, '0');
            return `今天 ${hours}:${minutes}`;
        }

        /**
         * 判断订单日期是否在指定的日期范围内
         * @param {string} dateStr - 订单日期 'YYYY-MM-DD'
         * @param {string} range   - 范围标识 all/7d/30d/90d/year
         * @returns {boolean}      - 是否在范围内
         */
        function isDateInRange(dateStr, range) {
            if (range === 'all') return true;
            const orderDate = new Date(dateStr);
            const today = new Date();
            today.setHours(0, 0, 0, 0);

            if (range === '7d') {
                const target = new Date(today);
                target.setDate(today.getDate() - 7);
                return orderDate >= target;
            }
            if (range === '30d') {
                const target = new Date(today);
                target.setDate(today.getDate() - 30);
                return orderDate >= target;
            }
            if (range === '90d') {
                const target = new Date(today);
                target.setDate(today.getDate() - 90);
                return orderDate >= target;
            }
            if (range === 'year') {
                const yearStart = new Date(today.getFullYear(), 0, 1);
                return orderDate >= yearStart;
            }
            return true;
        }

        // ============================================================================
        // 4. 筛选栏渲染与事件绑定
        // ============================================================================

        /** 初始化筛选栏DOM并绑定筛选逻辑 */
        function initFilterBar() {
            const bar = document.getElementById('filterBar');
            bar.innerHTML = `
                <div class="filter-group">
                    <span class="filter-label">${TEXT.filterDate}</span>
                    <select id="dateFilterSelect" class="filter-select">
                        <option value="all">${TEXT.filterDateAll}</option>
                        <option value="7d">${TEXT.filterDate7d}</option>
                        <option value="30d">${TEXT.filterDate30d}</option>
                        <option value="90d">${TEXT.filterDate90d}</option>
                        <option value="year">${TEXT.filterDateYear}</option>
                    </select>
                </div>
                <div class="filter-group">
                    <span class="filter-label">${TEXT.filterStatus}</span>
                    <select id="statusFilterSelect" class="filter-select">
                        <option value="all">${TEXT.filterStatusAll}</option>
                        <option value="已确认">${TEXT.filterStatusConfirmed}</option>
                        <option value="已排产">${TEXT.filterStatusScheduled}</option>
                        <option value="生产中">${TEXT.filterStatusProducing}</option>
                        <option value="已发货">${TEXT.filterStatusShipped}</option>
                        <option value="已完成">${TEXT.filterStatusCompleted}</option>
                    </select>
                </div>
                <button class="filter-btn" id="applyFilterBtn">${TEXT.filterApply}</button>
                <button class="filter-btn reset" id="resetFilterBtn">${TEXT.filterReset}</button>
            `;

            document.getElementById('applyFilterBtn').addEventListener('click', () => {
                currentFilter.dateRange = document.getElementById('dateFilterSelect').value;
                currentFilter.status = document.getElementById('statusFilterSelect').value;
                refreshAllOrderLists();
            });

            document.getElementById('resetFilterBtn').addEventListener('click', () => {
                document.getElementById('dateFilterSelect').value = 'all';
                document.getElementById('statusFilterSelect').value = 'all';
                currentFilter = { dateRange: 'all', status: 'all' };
                refreshAllOrderLists();
            });
        }

        /**
         * 根据当前筛选条件过滤订单数组
         * @param {Array} orders - 原始订单数组
         * @returns {Array}      - 过滤后的订单数组
         */
        function filterOrdersByCurrent(orders) {
            return orders.filter(order => {
                if (!isDateInRange(order.date, currentFilter.dateRange)) return false;
                if (currentFilter.status !== 'all' && order.status !== currentFilter.status) return false;
                return true;
            });
        }

        // ============================================================================
        // 5. 订单列表渲染
        // ============================================================================

        /**
         * 渲染指定类型的订单列表
         * @param {string} type        - 'active' 或 'completed'
         * @param {Array}  orders     - 要显示的订单数组
         */
        function renderOrderList(type, orders) {
            const listEl = document.getElementById(type === 'active' ? 'activeOrderList' : 'completedOrderList');
            if (orders.length === 0) {
                listEl.innerHTML = `<div class="empty-state"><div class="empty-icon"><i class="fas fa-inbox"></i></div><div>${type === 'active' ? TEXT.emptyActiveOrders : TEXT.emptyCompletedOrders}</div></div>`;
                return;
            }

            let html = '';
            orders.forEach(order => {
                const isSelected = (selectedOrder && selectedOrder.id === order.id && selectedOrderType === type);
                html += `
                    <div class="order-item ${isSelected ? 'selected' : ''}" data-order-id="${order.id}" data-order-type="${type}">
                        <div class="order-main-info">
                            <span class="order-id">${order.id}</span>
                            <span class="order-gs1">${TEXT.gs1Prefix} ${order.gs1}</span>
                        </div>
                        <div class="order-details-info">
                            <span class="order-amount">${order.amount}</span>
                            <span class="order-date">${order.date}</span>
                            <span class="order-status ${type === 'active' ? 'status-active' : 'status-completed'}">${order.status}</span>
                        </div>
                    </div>
                `;
            });
            listEl.innerHTML = html;

            // 为每个订单项绑定点击选择事件
            listEl.querySelectorAll('.order-item').forEach(item => {
                item.addEventListener('click', (e) => {
                    e.stopPropagation();
                    const orderId = item.dataset.orderId;
                    const orderType = item.dataset.orderType;
                    const sourceArray = orderType === 'active' ? ACTIVE_ORDERS : COMPLETED_ORDERS;
                    const order = sourceArray.find(o => o.id === orderId);
                    if (order) handleOrderSelection(order, orderType);
                });
            });
        }

        /** 刷新实时/已完成两个列表（基于当前筛选）并更新计数 */
        function refreshAllOrderLists() {
            const filteredActive = filterOrdersByCurrent(ACTIVE_ORDERS);
            const filteredCompleted = filterOrdersByCurrent(COMPLETED_ORDERS);

            document.getElementById('activeCount').innerText = filteredActive.length;
            document.getElementById('completedCount').innerText = filteredCompleted.length;

            renderOrderList('active', filteredActive);
            renderOrderList('completed', filteredCompleted);

            // 如果当前选中的订单已被筛掉，则清除选中并隐藏详情
            if (selectedOrder) {
                const stillExists = (selectedOrderType === 'active')
                    ? filteredActive.some(o => o.id === selectedOrder.id)
                    : filteredCompleted.some(o => o.id === selectedOrder.id);
                if (!stillExists) clearSelectedOrder();
            }
        }

        // ============================================================================
        // 6. 订单选中与详情控制
        // ============================================================================

        /**
         * 处理订单选中（来自点击）
         * @param {Object} order - 订单对象
         * @param {string} type  - 'active' 或 'completed'
         */
        function handleOrderSelection(order, type) {
            selectedOrder = order;
            selectedOrderType = type;

            // 移除所有列表项的高亮，然后为当前项添加高亮
            document.querySelectorAll('.order-item.selected').forEach(el => el.classList.remove('selected'));
            const currentItem = document.querySelector(`.order-item[data-order-id="${order.id}"]`);
            if (currentItem) currentItem.classList.add('selected');

            renderOrderDetails(); // 渲染详情区域
        }

        /** 清除当前选中的订单，并隐藏详情区域 */
        function clearSelectedOrder() {
            selectedOrder = null;
            selectedOrderType = null;
            document.querySelectorAll('.order-item.selected').forEach(el => el.classList.remove('selected'));
            document.getElementById('orderDetails').classList.remove('active');
        }

        /** 根据当前选中的订单类型渲染对应的详情视图 */
        function renderOrderDetails() {
            const detailsContainer = document.getElementById('orderDetails');
            if (!selectedOrder) {
                detailsContainer.classList.remove('active');
                return;
            }
            detailsContainer.classList.add('active');

            if (selectedOrderType === 'active') {
                renderActiveOrderDetail(selectedOrder);
            } else {
                renderCompletedOrderDetail(selectedOrder);
            }
        }

        // ------------- 实时订单详情渲染 -------------
        function renderActiveOrderDetail(order) {
            const container = document.getElementById('orderDetails');
            container.innerHTML = `
                <div class="details-header">
                    <div class="details-title">
                        <span>${TEXT.orderDetailsTitle} - <span class="details-order-id">${order.id}</span></span>
                        <span class="details-gs1">${TEXT.gs1Prefix} ${order.gs1}</span>
                    </div>
                    <div style="font-size:var(--text-sm);color:var(--gray);">${TEXT.lastUpdate}: ${getFormattedNow()}</div>
                </div>
                <div class="details-tabs" id="activeOrderTabs">
                    <div class="tab active" data-tab="progress">${TEXT.progressTracking}</div>
                    <div class="tab" data-tab="logistics">${TEXT.logisticsTracking}</div>
                    <div class="tab" data-tab="traceability">${TEXT.traceability}</div>
                </div>
                <div class="tab-content active" id="tabProgress"></div>
                <div class="tab-content" id="tabLogistics"></div>
                <div class="tab-content" id="tabTraceability"></div>
            `;

            fillProgressTab(order);
            fillLogisticsTab(order);
            fillTraceabilityTab(order, false);

            // 标签页切换
            document.querySelectorAll('#activeOrderTabs .tab').forEach(tab => {
                tab.addEventListener('click', function(e) {
                    const tabId = this.dataset.tab;
                    document.querySelectorAll('#activeOrderTabs .tab').forEach(t => t.classList.remove('active'));
                    this.classList.add('active');
                    document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
                    document.getElementById(`tab${tabId.charAt(0).toUpperCase() + tabId.slice(1)}`).classList.add('active');
                });
            });
        }

        /** 填充进度跟踪（横向时间轴） */
        function fillProgressTab(order) {
            const container = document.getElementById('tabProgress');
            let html = `<div class="progress-horizontal">`;
            order.progress.forEach((step, idx) => {
                let stepClass = '';
                if (step.completed) stepClass = 'step-completed';
                else if (idx === order.progress.findIndex(s => !s.completed)) stepClass = 'step-active';

                const iconMap = { 下单:'shopping-cart',审核:'check-circle',付款:'credit-card',排产:'calendar-alt',生产:'cogs',质检:'clipboard-check',发货:'shipping-fast' };
                const icon = iconMap[step.title] || 'circle';
                html += `
                    <div class="progress-step ${stepClass}">
                        <div class="step-icon"><i class="fas fa-${icon}"></i></div>
                        <div class="step-label">${step.title}</div>
                        <div class="step-time">${step.time}</div>
                        <div class="step-description">${step.description}</div>
                    </div>
                `;
            });
            html += `</div>`;
            container.innerHTML = html;
        }

        /** 填充物流跟踪（纵向时间线） */
        function fillLogisticsTab(order) {
            const container = document.getElementById('tabLogistics');
            if (!order.logisticsEvents || order.logisticsEvents.length === 0) {
                container.innerHTML = `<div class="empty-state"><i class="fas fa-truck"></i> 暂无物流信息</div>`;
                return;
            }
            let html = `<div class="logistics-timeline">`;
            order.logisticsEvents.forEach((ev, idx) => {
                let evClass = '';
                if (ev.completed) evClass = 'event-completed';
                else if (idx === order.logisticsEvents.findIndex(e => !e.completed)) evClass = 'event-active';
                html += `
                    <div class="logistics-event ${evClass}">
                        <div class="event-dot"></div>
                        <div class="event-info">
                            <div class="event-title">${ev.title}</div>
                            <div class="event-time">${ev.time}</div>
                            <div class="event-location">${ev.location}</div>
                        </div>
                    </div>
                `;
            });
            html += `</div>`;
            container.innerHTML = html;
        }

        /** 填充信息溯源（通用，可同时用于实时/已完成） */
        function fillTraceabilityTab(order, isCompleted = false) {
            const containerId = isCompleted ? 'completedTraceability' : 'tabTraceability';
            let container = document.getElementById(containerId);
            if (!container) {
                // 已完成订单详情中的溯源容器需要动态创建
                if (isCompleted) {
                    container = document.getElementById('completedTraceability');
                } else {
                    container = document.getElementById('tabTraceability');
                }
            }
            if (!container) return;

            let html = `<ul class="traceability-list">`;
            order.traceability.forEach(item => {
                let itemClass = 'traceability-item';
                if (item.status === 'completed') itemClass += ' traceability-completed';
                else if (item.status === 'active') itemClass += ' traceability-active';

                const iconMap = { 种植:'seedling',工厂:'industry',印染:'palette',质检:'clipboard-check',物流:'shipping-fast',仓库:'warehouse' };
                let icon = 'map-marker-alt';
                for (let [kw, ic] of Object.entries(iconMap)) {
                    if (item.location.includes(kw)) { icon = ic; break; }
                }
                html += `
                    <li class="${itemClass}">
                        <div class="traceability-icon"><i class="fas fa-${icon}"></i></div>
                        <div class="traceability-info">
                            <div class="traceability-location">${item.location}</div>
                            <div class="traceability-description">${item.description}</div>
                            <div class="traceability-time">${item.time}</div>
                        </div>
                    </li>
                `;
            });
            html += `</ul>`;
            container.innerHTML = html;
        }

        // ------------- 已完成订单详情渲染 -------------
        function renderCompletedOrderDetail(order) {
            const container = document.getElementById('orderDetails');
            container.innerHTML = `
                <div class="details-header">
                    <div class="details-title">
                        <span>${TEXT.orderDetailsTitle} - <span class="details-order-id">${order.id}</span></span>
                        <span class="details-gs1">${TEXT.gs1Prefix} ${order.gs1}</span>
                    </div>
                    <div style="font-size:var(--text-sm);color:var(--gray);">${TEXT.lastUpdate}: ${getFormattedNow()}</div>
                </div>
                <div class="completed-details">
                    <div class="completed-summary">
                        <div class="summary-card"><div class="summary-value">${order.amount}</div><div class="summary-label">${TEXT.orderAmount}</div></div>
                        <div class="summary-card"><div class="summary-value">${order.date}</div><div class="summary-label">${TEXT.orderDate}</div></div>
                        <div class="summary-card"><div class="summary-value">${order.deliveryDate}</div><div class="summary-label">${TEXT.deliveryDate}</div></div>
                    </div>
                    <h3 style="margin-bottom:var(--space-md);">${TEXT.traceability}</h3>
                    <div id="completedTraceability"></div>
                </div>
            `;
            fillTraceabilityTab(order, true);
        }

        // ============================================================================
        // 7. 订单分类卡片切换（互斥，收起时自动取消详情）
        // ============================================================================

        /**
         * 切换分类卡片的展开/收起状态，并确保两个卡片互斥
         * @param {string} categoryId - 被点击卡片的ID ('categoryActive' / 'categoryCompleted')
         */
        function toggleCategory(categoryId) {
            const current = document.getElementById(categoryId);
            const otherId = categoryId === 'categoryActive' ? 'categoryCompleted' : 'categoryActive';
            const other = document.getElementById(otherId);

            // 无论展开还是收起，先清除已选订单（隐藏详情）
            clearSelectedOrder();

            if (!current.classList.contains('active')) {
                // 展开当前，收起另一个
                current.classList.add('active');
                current.querySelector('.category-header').classList.add('active');
                other.classList.remove('active');
                other.querySelector('.category-header').classList.remove('active');
            } else {
                // 当前已展开，再次点击则收起自己
                current.classList.remove('active');
                current.querySelector('.category-header').classList.remove('active');
            }
        }

        /** 绑定分类卡片的点击事件（仅头部可触发） */
        function bindCategoryToggles() {
            const activeCat = document.getElementById('categoryActive');
            const completedCat = document.getElementById('categoryCompleted');

            activeCat.addEventListener('click', (e) => {
                if (e.target.closest('.category-header')) toggleCategory('categoryActive');
            });
            completedCat.addEventListener('click', (e) => {
                if (e.target.closest('.category-header')) toggleCategory('categoryCompleted');
            });
        }

        // ============================================================================
        // 8. 初始化入口
        // ============================================================================

        function initApp() {
            // 填充静态文本
            document.getElementById('systemName').innerText = TEXT.systemName;
            document.getElementById('systemSubtitle').innerText = TEXT.systemSubtitle;
            document.getElementById('userRole').innerText = TEXT.userRole;
            document.getElementById('activeTitle').innerText = TEXT.activeOrdersTitle;
            document.getElementById('completedTitle').innerText = TEXT.completedOrdersTitle;
            document.getElementById('activeSelectLabel').innerText = TEXT.selectActiveOrder;
            document.getElementById('completedSelectLabel').innerText = TEXT.selectCompletedOrder;

            // 初始化筛选栏
            initFilterBar();

            // 初次渲染订单列表
            refreshAllOrderLists();

            // 绑定分类切换事件
            bindCategoryToggles();

            // 默认展开实时订单卡片，便于用户操作
            document.getElementById('categoryActive').classList.add('active');
            document.getElementById('categoryActive').querySelector('.category-header').classList.add('active');

            // 确保详情区域初始为隐藏
            clearSelectedOrder();
        }

        // 启动应用程序
        document.addEventListener('DOMContentLoaded', initApp);
    </script>
</body>
</html>